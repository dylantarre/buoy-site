---
import Layout from './Layout.astro'
import Nav from '../components/Nav.astro'
import Footer from '../components/Footer.astro'

interface Props {
  title: string
  description?: string
  section?: string
}

const { title, description, section } = Astro.props

const docsSections = [
  {
    title: 'Getting Started',
    items: [
      { label: 'Introduction', href: '/docs' },
      { label: 'Installation', href: '/docs/installation' },
      { label: 'Quick Start', href: '/docs/quick-start' },
      { label: 'Configuration', href: '/docs/configuration' },
    ]
  },
  {
    title: 'Setup Commands',
    items: [
      { label: 'buoy begin', href: '/docs/cli/begin' },
      { label: 'buoy sweep', href: '/docs/cli/sweep' },
      { label: 'buoy dock', href: '/docs/cli/dock' },
    ]
  },
  {
    title: 'Drift Detection',
    items: [
      { label: 'buoy drift', href: '/docs/cli/drift' },
      { label: 'buoy check', href: '/docs/cli/check' },
      { label: 'buoy fix', href: '/docs/cli/fix' },
      { label: 'buoy baseline', href: '/docs/cli/baseline' },
      { label: 'buoy lighthouse', href: '/docs/cli/lighthouse' },
    ]
  },
  {
    title: 'AI Integration',
    items: [
      { label: 'buoy onboard', href: '/docs/cli/onboard' },
      { label: 'buoy skill', href: '/docs/cli/skill' },
      { label: 'buoy context', href: '/docs/cli/context' },
      { label: 'buoy explain', href: '/docs/cli/explain' },
    ]
  },
  {
    title: 'Design Tokens',
    items: [
      { label: 'buoy tokens', href: '/docs/cli/tokens' },
      { label: 'buoy anchor', href: '/docs/cli/anchor' },
      { label: 'buoy compare', href: '/docs/cli/compare' },
      { label: 'buoy import', href: '/docs/cli/import' },
    ]
  },
  {
    title: 'Analysis',
    items: [
      { label: 'buoy audit', href: '/docs/cli/audit' },
      { label: 'buoy graph', href: '/docs/cli/graph' },
      { label: 'buoy history', href: '/docs/cli/history' },
    ]
  },
  {
    title: 'Features',
    items: [
      { label: 'AI Guardrails', href: '/docs/features/ai-guardrails' },
      { label: 'Drift Detection', href: '/docs/features/drift-detection' },
      { label: 'Token Comparison', href: '/docs/features/token-comparison' },
      { label: 'Health Scoring', href: '/docs/features/health-scoring' },
    ]
  },
  {
    title: 'Integrations',
    items: [
      { label: 'GitHub Actions', href: '/docs/integrations/github-actions' },
      { label: 'Figma / Tokens Studio', href: '/docs/integrations/figma' },
    ]
  },
]

const currentPath = Astro.url.pathname
---

<Layout title={`${title} | Buoy Docs`} description={description}>
  <Nav />

  <div class="pt-16 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex gap-8 py-8">
        <!-- Sidebar -->
        <aside class="hidden lg:block w-64 shrink-0">
          <div class="sticky top-24 space-y-6">
            {docsSections.map((section) => (
              <div>
                <h3 class="text-xs font-semibold text-slate uppercase tracking-wide mb-2">
                  {section.title}
                </h3>
                <ul class="space-y-1">
                  {section.items.map((item) => {
                    const isActive = currentPath === item.href || currentPath === item.href + '/'
                    return (
                      <li>
                        <a
                          href={item.href}
                          class:list={[
                            'block px-3 py-1.5 text-sm rounded-lg transition-colors',
                            isActive
                              ? 'bg-buoy/20 text-buoy font-medium'
                              : 'text-slate hover:text-light hover:bg-navy-light/20'
                          ]}
                        >
                          {item.label}
                        </a>
                      </li>
                    )
                  })}
                </ul>
              </div>
            ))}
          </div>
        </aside>

        <!-- Mobile sidebar toggle -->
        <button
          id="docs-sidebar-toggle"
          class="lg:hidden fixed bottom-4 right-4 z-50 p-3 bg-buoy text-navy-dark rounded-full shadow-lg"
          aria-label="Toggle documentation menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

        <!-- Mobile sidebar -->
        <div id="docs-mobile-sidebar" class="hidden lg:hidden fixed inset-0 z-40">
          <div class="absolute inset-0 bg-navy-dark/80" id="docs-sidebar-backdrop"></div>
          <aside class="absolute right-0 top-0 bottom-0 w-72 bg-navy-dark border-l border-navy-light/20 p-6 overflow-y-auto">
            <div class="space-y-6">
              {docsSections.map((section) => (
                <div>
                  <h3 class="text-xs font-semibold text-slate uppercase tracking-wide mb-2">
                    {section.title}
                  </h3>
                  <ul class="space-y-1">
                    {section.items.map((item) => {
                      const isActive = currentPath === item.href || currentPath === item.href + '/'
                      return (
                        <li>
                          <a
                            href={item.href}
                            class:list={[
                              'block px-3 py-1.5 text-sm rounded-lg transition-colors',
                              isActive
                                ? 'bg-buoy/20 text-buoy font-medium'
                                : 'text-slate hover:text-light hover:bg-navy-light/20'
                            ]}
                          >
                            {item.label}
                          </a>
                        </li>
                      )
                    })}
                  </ul>
                </div>
              ))}
            </div>
          </aside>
        </div>

        <!-- Main content -->
        <main class="flex-1 min-w-0">
          <article class="prose prose-invert prose-buoy max-w-none">
            <slot />
          </article>
        </main>
      </div>
    </div>
  </div>

  <Footer />
</Layout>

<style is:global>
  /* Prose styling for docs */
  .prose-buoy {
    color: var(--color-slate);
  }

  .prose-buoy h1 {
    font-size: 1.875rem;
    font-weight: 700;
    font-family: 'Satoshi', system-ui, sans-serif;
    margin-bottom: 1rem;
    color: var(--color-light);
  }

  .prose-buoy h2 {
    font-size: 1.25rem;
    font-weight: 600;
    font-family: 'Satoshi', system-ui, sans-serif;
    margin-top: 2rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgb(36 51 82 / 0.2);
    color: var(--color-light);
  }

  .prose-buoy h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--color-light);
  }

  .prose-buoy p {
    margin-bottom: 1rem;
    line-height: 1.625;
  }

  .prose-buoy ul, .prose-buoy ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .prose-buoy li {
    margin-bottom: 0.5rem;
  }

  .prose-buoy code:not(pre code) {
    padding: 0.125rem 0.375rem;
    background: rgb(36 51 82 / 0.3);
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: var(--font-mono);
    color: var(--color-lavender);
  }

  .prose-buoy pre {
    background: var(--color-navy);
    border: 1px solid rgb(36 51 82 / 0.2);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .prose-buoy pre code {
    font-size: 0.875rem;
    font-family: var(--font-mono);
    color: var(--color-slate);
  }

  .prose-buoy a {
    color: var(--color-buoy);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose-buoy a:hover {
    color: var(--color-buoy-light);
  }

  .prose-buoy blockquote {
    border-left: 4px solid rgb(249 115 22 / 0.5);
    padding-left: 1rem;
    font-style: italic;
    color: var(--color-slate);
  }

  .prose-buoy table {
    width: 100%;
    margin-bottom: 1rem;
  }

  .prose-buoy th {
    text-align: left;
    padding: 0.5rem 1rem;
    background: rgb(36 51 82 / 0.2);
    color: var(--color-light);
    font-weight: 500;
  }

  .prose-buoy td {
    padding: 0.5rem 1rem;
    border-bottom: 1px solid rgb(36 51 82 / 0.2);
  }
</style>

<script>
  const toggle = document.getElementById('docs-sidebar-toggle')
  const sidebar = document.getElementById('docs-mobile-sidebar')
  const backdrop = document.getElementById('docs-sidebar-backdrop')

  toggle?.addEventListener('click', () => {
    sidebar?.classList.toggle('hidden')
  })

  backdrop?.addEventListener('click', () => {
    sidebar?.classList.add('hidden')
  })
</script>
